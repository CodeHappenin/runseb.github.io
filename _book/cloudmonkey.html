<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>CloudMonkey | Runseb.github.io</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="runseb">
        <meta name="description" content="Book generated using GitBook">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="./libcloud.html" />
        
        
        <link rel="prev" href="./feetwet.html" />
        

        <meta property="og:title" content="CloudMonkey | Runseb.github.io">
        <meta property="og:site_name" content="Runseb.github.io">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/runseb">
        <meta property="book:tag" content="GitBook">
        
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="gitbook/style.css">

        <script type="text/javascript">
        (function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
        for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
        mixpanel.init("01eb2b950ae09a5fdb15a98dcc5ff20e");
        </script>
        
    </head>
    <body>
        
<div class="book with-summary" data-github="runseb/runseb.github.io" data-level="3">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="https://github.com/runseb/runseb.github.io" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    <a href="https://github.com/runseb/runseb.github.io/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/runseb/runseb.github.io/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>


    <!-- Title -->
    <h1><a href="./README.html" >Runseb.github.io</a></h1>
</div>
    <div class="book-summary">
    <ul class="summary">
        <li>
            <a href="https://github.com/runseb" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/runseb/runseb.github.io/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/runseb/runseb.github.io/edit/master/cloudmonkey.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        <li data-level="0">
            <a href="./README.html"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1">
                
                <a href="./README.html">
                    <i class="fa fa-check"></i> <b>1)</b> Introduction
                </a>
                
                
            </li>
        
            <li  data-level="2">
                
                <a href="./feetwet.html">
                    <i class="fa fa-check"></i> <b>2)</b> Getting your feet wet
                </a>
                
                
            </li>
        
            <li class="active" data-level="3">
                
                <a href="./cloudmonkey.html">
                    <i class="fa fa-check"></i> <b>3)</b> CloudMonkey
                </a>
                
                
            </li>
        
            <li  data-level="4">
                
                <a href="./libcloud.html">
                    <i class="fa fa-check"></i> <b>4)</b> Apache Libcloud
                </a>
                
                
            </li>
        
            <li  data-level="5">
                
                <a href="./vagrant.html">
                    <i class="fa fa-check"></i> <b>5)</b> Vagrant
                </a>
                
                
            </li>
        
            <li  data-level="6">
                
                <a href="./ansible.html">
                    <i class="fa fa-check"></i> <b>6)</b> Ansible
                </a>
                
                
            </li>
        
    </ul>
</div>
    <div class="book-body" tabindex="-1">
        <div class="page-wrapper">
            <div class="book-progress">
                <div class="bar">
                    <div class="inner" style="width: 40%;min-width: 20%;"></div>
                </div>
                <div class="chapters">
                
                    <a href="./README.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
                
                    <a href="./feetwet.html" title="Getting your feet wet" class="chapter done new-chapter" data-progress="2" style="left: 20%;"></a>
                
                    <a href="./cloudmonkey.html" title="CloudMonkey" class="chapter done new-chapter" data-progress="3" style="left: 40%;"></a>
                
                    <a href="./libcloud.html" title="Apache Libcloud" class="chapter  new-chapter" data-progress="4" style="left: 60%;"></a>
                
                    <a href="./vagrant.html" title="Vagrant" class="chapter  new-chapter" data-progress="5" style="left: 80%;"></a>
                
                    <a href="./ansible.html" title="Ansible" class="chapter  new-chapter" data-progress="6" style="left: 100%;"></a>
                
                </div>
            </div>

            <div class="page-inner">
            
                <section class="normal" id="section-gitbook_3">
                
                    <h1 id="cloudmonkey-an-interactive-shell-to-your-cloud">CloudMonkey, an interactive shell to your cloud</h1>
<p>The exoscale cloud is based on CloudStack. It exposes the CloudStack native API. Let&#39;s use CloudMonkey, the ACS cli.</p>
<pre><code>pip <span class="hljs-keyword">install</span> cloudmonkey
cloudmonkey
</code></pre><p>The full documentation for cloudmonkey is on the <a href="https://cwiki.apache.org/confluence/display/CLOUDSTACK/CloudStack+cloudmonkey+CLI" target="_blank">wiki</a></p>
<pre><code><span class="hljs-keyword">set</span> port <span class="hljs-number">443</span>
<span class="hljs-keyword">set</span> protocol https
<span class="hljs-keyword">set</span> path /compute
<span class="hljs-keyword">set</span> host api<span class="hljs-preprocessor">.exoscale</span><span class="hljs-preprocessor">.ch</span>
<span class="hljs-keyword">set</span> apikey &lt;yourapikey&gt;
<span class="hljs-keyword">set</span> secretkey &lt;secretkey&gt;
</code></pre><p>Explore the ACS native API with CloudMonkey and tab tab....</p>
<h2 id="tabular-output">Tabular Output</h2>
<p>The number of key/value pairs returned by the api calls can be large
resulting in a very long output. To enable easier viewing of the output,
a tabular formatting can be setup. You may enable tabular listing and
even choose set of column fields, this allows you to create your own
field using the filter param which takes in comma separated argument. If
argument has a space, put them under double quotes. The create table
will have the same sequence of field filters provided</p>
<p>To enable it, use the <em>set</em> function and create filters like so:</p>
<pre><code>&gt; set display table
&gt; list zones filter=name,id
count = 1
<span class="hljs-header">zone:
+--------+--------------------------------------+</span>
<span class="hljs-header">|  name  |                  id                  |
+--------+--------------------------------------+</span>
<span class="hljs-header">| CH-GV2 | 1128bd56-b4d9-4ac6-a7b9-c715b187ce11 |
+--------+--------------------------------------+</span>
</code></pre><h2 id="starting-a-virtual-machine-instance-with-cloudmonkey">Starting a Virtual Machine instance with CloudMonkey</h2>
<p>To start a virtual machine instance we will use the <em>deployvirtualmachine</em> call.</p>
<pre><code>cloudmonkey&gt;deploy virtualmachine -h
Creates <span class="hljs-keyword">and</span> automatically starts a <span class="hljs-keyword">virtual</span> machine based <span class="hljs-keyword">on</span> a service offering, disk offering, <span class="hljs-keyword">and</span> template.
Required args: serviceofferingid templateid zoneid
Args: account diskofferingid displayname domainid <span class="hljs-keyword">group</span> hostid hypervisor ipaddress iptonetworklist isAsync keyboard keypair name networkids projectid securitygroupids securitygroupnames serviceofferingid size startvm templateid userdata zoneid
</code></pre><p>The required arguments are <em>serviceofferingid, templateid and zoneid</em></p>
<p>In order to specify the template that we want to use, we can list all
available templates with the following call:</p>
<pre><code><span class="hljs-code"> &gt; list templates filter=id,displaytext templatefilter=executable</span>
count = 36
<span class="hljs-header">template:
+--------------------------------------+------------------------------------------+</span>
<span class="hljs-header">|                  id                  |               displaytext                |
+--------------------------------------+------------------------------------------+</span>
| 3235e860-2f00-416a-9fac-79a03679ffd8 | Windows Server 2012 R2 WINRM 100GB Disk  |
| 20d4ebc3-8898-431c-939e-adbcf203acec |   Linux Ubuntu 13.10 64-bit 10 GB Disk   |
| 70d31a38-c030-490b-bca9-b9383895ade7 |   Linux Ubuntu 13.10 64-bit 50 GB Disk   |
| 4822b64b-418f-4d6b-b64e-1517bb862511 |  Linux Ubuntu 13.10 64-bit 100 GB Disk   |
| 39bc3611-5aea-4c83-a29a-7455298241a7 |  Linux Ubuntu 13.10 64-bit 200 GB Disk   |
...&lt;snipped&gt;
</code></pre><p>Similarly to get the <em>serviceofferingid</em> you would do:</p>
<pre><code>&gt; list serviceofferings filter=id,name
count = 7
<span class="hljs-header">serviceoffering:
+--------------------------------------+-------------+</span>
<span class="hljs-header">|                  id                  |     name    |
+--------------------------------------+-------------+</span>
| 71004023-bb72-4a97-b1e9-bc66dfce9470 |    Micro    |
| b6cd1ff5-3a2f-4e9d-a4d1-8988c1191fe8 |     Tiny    |
| 21624abb-764e-4def-81d7-9fc54b5957fb |    Small    |
| b6e9d1e8-89fc-4db3-aaa4-9b4c5b1d0844 |    Medium   |
| c6f99499-7f59-4138-9427-a09db13af2bc |    Large    |
| 350dc5ea-fe6d-42ba-b6c0-efb8b75617ad | Extra-large |
<span class="hljs-header">| a216b0d1-370f-4e21-a0eb-3dfc6302b564 |     Huge    |
+--------------------------------------+-------------+</span>
</code></pre><p>Note that we can use the linux pipe as well as standard linux commands
within the interactive shell. Finally we would start an instance with
the following call:</p>
<pre><code>cloudmonkey<span class="hljs-subst">&gt;</span>deploy virtualmachine templateid<span class="hljs-subst">=</span><span class="hljs-number">20</span>d4ebc3<span class="hljs-subst">-</span><span class="hljs-number">8898</span><span class="hljs-subst">-</span><span class="hljs-number">431</span>c<span class="hljs-subst">-</span><span class="hljs-number">939</span>e<span class="hljs-attribute">-adbcf203acec</span> zoneid<span class="hljs-subst">=</span><span class="hljs-number">1128</span>bd56<span class="hljs-attribute">-b4d9</span><span class="hljs-subst">-</span><span class="hljs-number">4</span>ac6<span class="hljs-attribute">-a7b9</span><span class="hljs-attribute">-c715b187ce11</span> serviceofferingid<span class="hljs-subst">=</span><span class="hljs-number">71004023</span><span class="hljs-attribute">-bb72</span><span class="hljs-subst">-</span><span class="hljs-number">4</span>a97<span class="hljs-attribute">-b1e9</span><span class="hljs-attribute">-bc66dfce9470</span>
id <span class="hljs-subst">=</span> <span class="hljs-number">5566</span>c27c<span class="hljs-attribute">-e31c</span><span class="hljs-subst">-</span><span class="hljs-number">438e-9</span>d97<span class="hljs-attribute">-c5d5904453dc</span>
jobid <span class="hljs-subst">=</span> <span class="hljs-number">334</span>fbc33<span class="hljs-attribute">-c720</span><span class="hljs-subst">-</span><span class="hljs-number">46</span>ba<span class="hljs-attribute">-a710</span><span class="hljs-subst">-</span><span class="hljs-number">182</span>af31e76df
</code></pre><p>This is an asynchronous job, therefore it returns a <code>jobid</code>, you can query the state of this job with:</p>
<pre><code><span class="hljs-subst">&gt;</span> query asyncjobresult jobid<span class="hljs-subst">=</span><span class="hljs-number">334</span>fbc33<span class="hljs-attribute">-c720</span><span class="hljs-subst">-</span><span class="hljs-number">46</span>ba<span class="hljs-attribute">-a710</span><span class="hljs-subst">-</span><span class="hljs-number">182</span>af31e76df
accountid <span class="hljs-subst">=</span> b8c0baab<span class="hljs-subst">-</span><span class="hljs-number">18</span>a1<span class="hljs-subst">-</span><span class="hljs-number">44</span>c0<span class="hljs-attribute">-ab67</span><span class="hljs-attribute">-e24049212925</span>
cmd <span class="hljs-subst">=</span> com<span class="hljs-built_in">.</span>cloud<span class="hljs-built_in">.</span>api<span class="hljs-built_in">.</span>commands<span class="hljs-built_in">.</span>DeployVMCmd
created <span class="hljs-subst">=</span> <span class="hljs-number">2014</span><span class="hljs-subst">-</span><span class="hljs-number">03</span><span class="hljs-subst">-</span><span class="hljs-number">05</span>T13:<span class="hljs-number">40</span>:<span class="hljs-number">18</span><span class="hljs-subst">+</span><span class="hljs-number">0100</span>
jobid <span class="hljs-subst">=</span> <span class="hljs-number">334</span>fbc33<span class="hljs-attribute">-c720</span><span class="hljs-subst">-</span><span class="hljs-number">46</span>ba<span class="hljs-attribute">-a710</span><span class="hljs-subst">-</span><span class="hljs-number">182</span>af31e76df
jobinstanceid <span class="hljs-subst">=</span> <span class="hljs-number">5566</span>c27c<span class="hljs-attribute">-e31c</span><span class="hljs-subst">-</span><span class="hljs-number">438e-9</span>d97<span class="hljs-attribute">-c5d5904453dc</span>
jobinstancetype <span class="hljs-subst">=</span> VirtualMachine
jobprocstatus <span class="hljs-subst">=</span> <span class="hljs-number">0</span>
jobresultcode <span class="hljs-subst">=</span> <span class="hljs-number">0</span>
jobstatus <span class="hljs-subst">=</span> <span class="hljs-number">0</span>
userid <span class="hljs-subst">=</span> <span class="hljs-number">968</span>f6b4e<span class="hljs-attribute">-b382</span><span class="hljs-subst">-</span><span class="hljs-number">4802</span><span class="hljs-attribute">-afea</span><span class="hljs-attribute">-dd731d4cf9b9</span>
</code></pre><p>Once the machine is started you can list it:</p>
<pre><code>&gt; list virtualmachines filter=id,displayname
count = 1
<span class="hljs-header">virtualmachine:
+--------------------------------------+--------------------------------------+</span>
<span class="hljs-header">|                  id                  |             displayname              |
+--------------------------------------+--------------------------------------+</span>
<span class="hljs-header">| 5566c27c-e31c-438e-9d97-c5d5904453dc | 5566c27c-e31c-438e-9d97-c5d5904453dc |
+--------------------------------------+--------------------------------------+</span>
</code></pre><p>The instance would be stopped with:</p>
<pre><code>&gt; stop virtualmachine id=5566c27c-e31c-438e-9d97-c5d5904453dc
jobid = 391b4666-293c-442b-8a16-aeb64eef0246

&gt; list virtualmachines filter=id,displayname,state
count = 1
<span class="hljs-header">virtualmachine:
+--------------------------------------+--------------------------------------+---------+</span>
<span class="hljs-header">|                  id                  |             displayname              |  state  |
+--------------------------------------+--------------------------------------+---------+</span>
<span class="hljs-header">| 5566c27c-e31c-438e-9d97-c5d5904453dc | 5566c27c-e31c-438e-9d97-c5d5904453dc | Stopped |
+--------------------------------------+--------------------------------------+---------+</span>
</code></pre><p>The <em>ids</em> that you will use will differ from this example. Make sure you use the ones that corresponds to your CloudStack cloud.</p>
<p>Try to create a <code>sshkeypair</code> with <code>create sshkeypair</code>, a <code>securitygroup</code> with <code>create securitygroup</code> and add some rules to it.</p>
<p>With CloudMonkey all CloudStack APIs are available.</p>

                
                </section>
            
            </div>

            <div class="page-footer">
                
                    
                        
                        <a href="./libcloud.html" class="navigation-link next">Next</a>
                        
                    
                
            </div>
        </div>
    </div>
</div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="gitbook/app.js"></script>
    </body>
</html>