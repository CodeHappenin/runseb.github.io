<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Apache Libcloud | Runseb.github.io</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="runseb">
        <meta name="description" content="Book generated using GitBook">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="./vagrant.html" />
        
        
        <link rel="prev" href="./cloudmonkey.html" />
        

        <meta property="og:title" content="Apache Libcloud | Runseb.github.io">
        <meta property="og:site_name" content="Runseb.github.io">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/runseb">
        <meta property="book:tag" content="GitBook">
        
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="gitbook/style.css">

        <script type="text/javascript">
        (function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
        for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
        mixpanel.init("01eb2b950ae09a5fdb15a98dcc5ff20e");
        </script>
        
    </head>
    <body>
        
<div class="book with-summary" data-github="runseb/runseb.github.io" data-level="4">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="https://github.com/runseb/runseb.github.io" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    <a href="https://github.com/runseb/runseb.github.io/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/runseb/runseb.github.io/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>


    <!-- Title -->
    <h1><a href="./README.html" >Runseb.github.io</a></h1>
</div>
    <div class="book-summary">
    <ul class="summary">
        <li>
            <a href="https://github.com/runseb" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/runseb/runseb.github.io/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/runseb/runseb.github.io/edit/master/libcloud.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        <li data-level="0">
            <a href="./README.html"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1">
                
                <a href="./README.html">
                    <i class="fa fa-check"></i> <b>1)</b> Introduction
                </a>
                
                
            </li>
        
            <li  data-level="2">
                
                <a href="./feetwet.html">
                    <i class="fa fa-check"></i> <b>2)</b> Getting your feet wet
                </a>
                
                
            </li>
        
            <li  data-level="3">
                
                <a href="./cloudmonkey.html">
                    <i class="fa fa-check"></i> <b>3)</b> CloudMonkey
                </a>
                
                
            </li>
        
            <li class="active" data-level="4">
                
                <a href="./libcloud.html">
                    <i class="fa fa-check"></i> <b>4)</b> Apache Libcloud
                </a>
                
                
            </li>
        
            <li  data-level="5">
                
                <a href="./vagrant.html">
                    <i class="fa fa-check"></i> <b>5)</b> Vagrant
                </a>
                
                
            </li>
        
            <li  data-level="6">
                
                <a href="./ansible.html">
                    <i class="fa fa-check"></i> <b>6)</b> Ansible
                </a>
                
                
            </li>
        
    </ul>
</div>
    <div class="book-body" tabindex="-1">
        <div class="page-wrapper">
            <div class="book-progress">
                <div class="bar">
                    <div class="inner" style="width: 60%;min-width: 40%;"></div>
                </div>
                <div class="chapters">
                
                    <a href="./README.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
                
                    <a href="./feetwet.html" title="Getting your feet wet" class="chapter done new-chapter" data-progress="2" style="left: 20%;"></a>
                
                    <a href="./cloudmonkey.html" title="CloudMonkey" class="chapter done new-chapter" data-progress="3" style="left: 40%;"></a>
                
                    <a href="./libcloud.html" title="Apache Libcloud" class="chapter done new-chapter" data-progress="4" style="left: 60%;"></a>
                
                    <a href="./vagrant.html" title="Vagrant" class="chapter  new-chapter" data-progress="5" style="left: 80%;"></a>
                
                    <a href="./ansible.html" title="Ansible" class="chapter  new-chapter" data-progress="6" style="left: 100%;"></a>
                
                </div>
            </div>

            <div class="page-inner">
            
                <section class="normal" id="section-gitbook_5">
                
                    <h1 id="apache-libcloud">Apache libcloud</h1>
<p>Libcloud is a python module that abstracts the different APIs of most cloud providers. It offers a common API for the basic functionality of clouds list nodes,sizes,templates, create nodes etc...Libcloud can be used with CloudStack, OpenStack, Opennebula, GCE, AWS.</p>
<p>Check the CloudStack driver <a href="https://libcloud.readthedocs.org/en/latest/compute/drivers/cloudstack.html" target="_blank">documentation</a></p>
<h2 id="installation">Installation</h2>
<p>To install Libcloud refer to the libcloud <a href="http://libcloud.apache.org" target="_blank">website</a>. Or simply do:</p>
<pre><code>pip <span class="hljs-keyword">install</span> apache-libcloud
</code></pre><h2 id="generic-use-of-libcloud-with-cloudstack">Generic use of Libcloud with CloudStack</h2>
<p>With libcloud installed, you can now open a Python interactive shell, create an instance of a CloudStack driver
and call the available methods via the libcloud API.</p>
<p>First you need to import the libcloud modules and create a CloudStack
driver.</p>
<pre><code><span class="hljs-prompt">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> libcloud.compute.types <span class="hljs-keyword">import</span> Provider
<span class="hljs-prompt">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> libcloud.compute.providers <span class="hljs-keyword">import</span> get_driver
<span class="hljs-prompt">&gt;&gt;&gt; </span>Driver = get_driver(Provider.CLOUDSTACK)
</code></pre><p>Then, using your keys and endpoint, create a connection object. Note
that this is a local test and thus not secured. If you use a CloudStack
public cloud, make sure to use SSL properly (i.e <code>secure=True</code>). Replace the host and path with the ones of your public cloud. For exoscale use <code>host=&#39;http://api.exoscale.ch</code> and <code>path=/compute</code></p>
<pre><code><span class="hljs-prompt">&gt;&gt;&gt; </span>apikey=<span class="hljs-string">'plgWJfZK4gyS3mlZLYq_u38zCm0bewzGUdP66mg'</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>secretkey=<span class="hljs-string">'VDaACYb0LV9eNjeq1EhwJaw7FF3akA3KBQ'</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>host=<span class="hljs-string">'http://localhost:8080'</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>path=<span class="hljs-string">'/client/api'</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>conn=Driver(key=apikey,secret=secretkey,secure=<span class="hljs-keyword">False</span>,host=<span class="hljs-string">'localhost'</span>,port=<span class="hljs-string">'8080'</span>,path=path)
</code></pre><p>With the connection object in hand, you now use the libcloud base api to
list such things as the templates (i.e images), the service offerings
(i.e sizes) and the zones (i.e locations)</p>
<pre><code>&gt;&gt;&gt; conn.list_images()
[&lt;NodeImage: id=13ccff62-132b-4caf-b456-e8ef20cbff0e, name=tiny Linux, driver=CloudStack  <span class="hljs-keyword">...</span>&gt;]
&gt;&gt;&gt; conn.list_sizes()
[&lt;NodeSize: id=ef2537ad-c70f-<span class="hljs-number">11e1</span>-821b-0800277e749c, name=tinyOffering, ram=<span class="hljs-number">100</span> disk=<span class="hljs-number">0</span> bandwidth=<span class="hljs-number">0</span> price=<span class="hljs-number">0</span> driver=CloudStack <span class="hljs-keyword">...</span>&gt;,
&lt;NodeSize: id=c66c2557-12a7-4b32-94f4-48837da3fa84, name=Small Instance, ram=<span class="hljs-number">512</span> disk=<span class="hljs-number">0</span> bandwidth=<span class="hljs-number">0</span> price=<span class="hljs-number">0</span> driver=CloudStack <span class="hljs-keyword">...</span>&gt;,
&lt;NodeSize: id=3d8b82e5-d8e7-48d5-a554-cf853111bc50, name=Medium Instance, ram=<span class="hljs-number">1024</span> disk=<span class="hljs-number">0</span> bandwidth=<span class="hljs-number">0</span> price=<span class="hljs-number">0</span> driver=CloudStack <span class="hljs-keyword">...</span>&gt;]
&gt;&gt;&gt; images=conn.list_images()
&gt;&gt;&gt; offerings=conn.list_sizes()
</code></pre><p>The <code>create_node</code> method will take an instance name, a template and an
instance type as arguments. It will return an instance of a
<em>CloudStackNode</em> that has additional extensions methods, such as
<code>ex_stop</code> and <code>ex_start</code>.</p>
<pre><code><span class="hljs-prompt">&gt;&gt;&gt; </span>node=conn.create_node(name=<span class="hljs-string">'toto'</span>,image=images[<span class="hljs-number">0</span>],size=offerings[<span class="hljs-number">0</span>])
<span class="hljs-prompt">&gt;&gt;&gt; </span>help(node)
<span class="hljs-prompt">&gt;&gt;&gt; </span>node.get_uuid()
<span class="hljs-string">'b1aa381ba1de7f2d5048e248848993d5a900984f'</span>
<span class="hljs-prompt">&gt;&gt;&gt; </span>node.name
<span class="hljs-string">u'toto'</span>
</code></pre><h2 id="libcloud-with-exoscale">libcloud with exoscale</h2>
<p>Libcloud also has an exoscale specific driver. For complete description see this recent <a href="https://www.exoscale.ch/syslog/2014/01/27/licloud-guest-post/" target="_blank">post</a> from Tomaz Murauz the VP of Apache Libcloud.</p>
<p>To get you started quickly, save the following script in a .py file.</p>
<pre><code><span class="hljs-comment">#!/usr/bin/env python</span>

<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">from</span> IPython.terminal.embed <span class="hljs-keyword">import</span> InteractiveShellEmbed
<span class="hljs-keyword">from</span> libcloud.compute.types <span class="hljs-keyword">import</span> Provider
<span class="hljs-keyword">from</span> libcloud.compute.providers <span class="hljs-keyword">import</span> get_driver
<span class="hljs-keyword">from</span> libcloud.compute.deployment <span class="hljs-keyword">import</span> ScriptDeployment
<span class="hljs-keyword">from</span> libcloud.compute.deployment <span class="hljs-keyword">import</span> MultiStepDeployment

apikey=os.getenv(<span class="hljs-string">'EXOSCALE_API_KEY'</span>)
secretkey=os.getenv(<span class="hljs-string">'EXOSCALE_SECRET_KEY'</span>)
Driver = get_driver(Provider.EXOSCALE)
conn=Driver(key=apikey,secret=secretkey)

<span class="hljs-keyword">print</span> conn.list_locations()

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">listimages</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> conn.list_images():
        <span class="hljs-keyword">print</span> i.id, i.extra[<span class="hljs-string">'displaytext'</span>]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">listsizes</span><span class="hljs-params">()</span>:</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> conn.list_sizes():
        <span class="hljs-keyword">print</span> i.id, i.name

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getimage</span><span class="hljs-params">(id)</span>:</span>
    <span class="hljs-keyword">return</span> [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> conn.list_images() <span class="hljs-keyword">if</span> i.id == id][<span class="hljs-number">0</span>]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getsize</span><span class="hljs-params">(id)</span>:</span>
    <span class="hljs-keyword">return</span> [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> conn.list_sizes() <span class="hljs-keyword">if</span> i.id == id][<span class="hljs-number">0</span>]

script=ScriptDeployment(<span class="hljs-string">"/bin/date"</span>)
image=getimage(<span class="hljs-string">'2c8bede9-c3b6-4450-9985-7b715d8e58c5'</span>)
size=getsize(<span class="hljs-string">'71004023-bb72-4a97-b1e9-bc66dfce9470'</span>)
msd = MultiStepDeployment([script])

<span class="hljs-comment"># directly open the shell</span>
shell = InteractiveShellEmbed(banner1=<span class="hljs-string">"Hello from Libcloud Shell !!"</span>)
shell()
</code></pre><p>Set your API keys properly and execute the script. You can now explore the libcloud API interactively, try to start a node, and also deploy a node. For instance type <code>list</code> and press the tab key.</p>

                
                </section>
            
            </div>

            <div class="page-footer">
                
                    
                        
                        <a href="./vagrant.html" class="navigation-link next">Next</a>
                        
                    
                
            </div>
        </div>
    </div>
</div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="gitbook/app.js"></script>
    </body>
</html>