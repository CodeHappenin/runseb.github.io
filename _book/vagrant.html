<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>Vagrant | Runseb.github.io</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="runseb">
        <meta name="description" content="Book generated using GitBook">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        <link rel="next" href="./ansible.html" />
        
        
        <link rel="prev" href="./libcloud.html" />
        

        <meta property="og:title" content="Vagrant | Runseb.github.io">
        <meta property="og:site_name" content="Runseb.github.io">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/runseb">
        <meta property="book:tag" content="GitBook">
        
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="gitbook/style.css">

        <script type="text/javascript">
        (function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
        for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
        mixpanel.init("01eb2b950ae09a5fdb15a98dcc5ff20e");
        </script>
        
    </head>
    <body>
        
<div class="book with-summary" data-github="runseb/runseb.github.io" data-level="5">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="https://github.com/runseb/runseb.github.io" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    <a href="https://github.com/runseb/runseb.github.io/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/runseb/runseb.github.io/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>


    <!-- Title -->
    <h1><a href="./README.html" >Runseb.github.io</a></h1>
</div>
    <div class="book-summary">
    <ul class="summary">
        <li>
            <a href="https://github.com/runseb" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/runseb/runseb.github.io/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/runseb/runseb.github.io/edit/master/vagrant.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        <li data-level="0">
            <a href="./README.html"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1">
                
                <a href="./README.html">
                    <i class="fa fa-check"></i> <b>1)</b> Introduction
                </a>
                
                
            </li>
        
            <li  data-level="2">
                
                <a href="./feetwet.html">
                    <i class="fa fa-check"></i> <b>2)</b> Getting your feet wet
                </a>
                
                
            </li>
        
            <li  data-level="3">
                
                <a href="./cloudmonkey.html">
                    <i class="fa fa-check"></i> <b>3)</b> CloudMonkey
                </a>
                
                
            </li>
        
            <li  data-level="4">
                
                <a href="./libcloud.html">
                    <i class="fa fa-check"></i> <b>4)</b> Apache Libcloud
                </a>
                
                
            </li>
        
            <li class="active" data-level="5">
                
                <a href="./vagrant.html">
                    <i class="fa fa-check"></i> <b>5)</b> Vagrant
                </a>
                
                
            </li>
        
            <li  data-level="6">
                
                <a href="./ansible.html">
                    <i class="fa fa-check"></i> <b>6)</b> Ansible
                </a>
                
                
            </li>
        
    </ul>
</div>
    <div class="book-body" tabindex="-1">
        <div class="page-wrapper">
            <div class="book-progress">
                <div class="bar">
                    <div class="inner" style="width: 80%;min-width: 60%;"></div>
                </div>
                <div class="chapters">
                
                    <a href="./README.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
                
                    <a href="./feetwet.html" title="Getting your feet wet" class="chapter done new-chapter" data-progress="2" style="left: 20%;"></a>
                
                    <a href="./cloudmonkey.html" title="CloudMonkey" class="chapter done new-chapter" data-progress="3" style="left: 40%;"></a>
                
                    <a href="./libcloud.html" title="Apache Libcloud" class="chapter done new-chapter" data-progress="4" style="left: 60%;"></a>
                
                    <a href="./vagrant.html" title="Vagrant" class="chapter done new-chapter" data-progress="5" style="left: 80%;"></a>
                
                    <a href="./ansible.html" title="Ansible" class="chapter  new-chapter" data-progress="6" style="left: 100%;"></a>
                
                </div>
            </div>

            <div class="page-inner">
            
                <section class="normal" id="section-gitbook_6">
                
                    <h1 id="vagrant-boxes">Vagrant boxes</h1>
<h2 id="install-vagrant-and-create-the-exo-boxes">Install Vagrant and create the exo boxes</h2>
<p><a href="http://vagrantup.com" target="_blank">Vagrant</a> is a tool to create <em>lightweight, portable and reproducible development environments</em>. Specifically it allows you to use configuration management tools to configure a virtual machine locally (via virtualbox) and then deploy it <em>in the cloud</em> via Vagrant providers. 
In this next exercise we are going to install vagrant on our local machine and use Exoscale vagrant boxes to provision VM in the Cloud using configuration setup in Vagrant. For future reading check this <a href="http://sebgoa.blogspot.co.uk/2013/12/veewee-vagrant-and-cloudstack.html" target="_blank">post</a></p>
<p>First install <a href="http://www.vagrantup.com/downloads.html" target="_blank">Vagrant</a> and then get the cloudstack plugin:</p>
<pre><code>vagrant plugin <span class="hljs-keyword">install</span> vagrant-cloudstack
</code></pre><p>Then we are going to clone a small github <a href="https://github.com/exoscale/vagrant-exoscale-boxes" target="_blank">project</a> from exoscale. This project is going to give us <em>vagrant boxes</em>, fake virtual machine images that refer to Exoscale templates available.</p>
<pre><code>git clone https:<span class="hljs-comment">//github.com/exoscale/vagrant-exoscale-boxes</span>
cd vagrant<span class="hljs-attribute">-exoscale</span><span class="hljs-attribute">-boxes</span>
</code></pre><p>Edit the <code>config.py</code> script to specify your API keys, then run:</p>
<pre><code>python ./make-boxes<span class="hljs-preprocessor">.py</span>
</code></pre><p>If you are familiar with Vagrant this will be straightforward, if not, you need to add a box to your local installation for instance:</p>
<pre><code>vagrant box add Linux<span class="hljs-attribute">-Ubuntu</span><span class="hljs-subst">-</span><span class="hljs-number">13.10</span><span class="hljs-subst">-</span><span class="hljs-number">64</span><span class="hljs-attribute">-bit</span><span class="hljs-subst">-</span><span class="hljs-number">50</span><span class="hljs-attribute">-GB</span><span class="hljs-attribute">-Disk</span> /path/<span class="hljs-literal">or</span>/url/<span class="hljs-keyword">to</span>/boxes/Linux<span class="hljs-attribute">-Ubuntu</span><span class="hljs-subst">-</span><span class="hljs-number">13.10</span><span class="hljs-subst">-</span><span class="hljs-number">64</span><span class="hljs-attribute">-bit</span><span class="hljs-subst">-</span><span class="hljs-number">50</span><span class="hljs-attribute">-GB</span><span class="hljs-attribute">-Disk</span><span class="hljs-built_in">.</span>box
</code></pre><h2 id="initialize-a-vagrantfile-and-start-an-instance">Initialize a <code>Vagrantfile</code> and start an instance</h2>
<p>Now you need to create a <em>Vagrantfile</em>. In the directory of you choice  for example <code>/tutorial</code> do:</p>
<pre><code>vagrant init
</code></pre><p>Then edit the <code>Vagrantfile</code> created to contain this:</p>
<pre><code>Vagrant<span class="hljs-preprocessor">.configure</span>(<span class="hljs-string">"2"</span>) do |config|
    config<span class="hljs-preprocessor">.vm</span><span class="hljs-preprocessor">.box</span> = <span class="hljs-string">"Linux-Ubuntu-13.10-64-bit-50-GB-Disk"</span>
    config<span class="hljs-preprocessor">.ssh</span><span class="hljs-preprocessor">.username</span> = <span class="hljs-string">"root"</span>
    config<span class="hljs-preprocessor">.ssh</span><span class="hljs-preprocessor">.private</span>_key_path = <span class="hljs-string">"/Users/vagrant/.ssh/id_rsa.vagrant"</span>

    config<span class="hljs-preprocessor">.vm</span><span class="hljs-preprocessor">.provider</span> :cloudstack do |cloudstack, override|
        cloudstack<span class="hljs-preprocessor">.api</span>_key = <span class="hljs-string">"AAAAAAAAAAAAAAAA-aaaaaaaaaaa"</span>
        cloudstack<span class="hljs-preprocessor">.secret</span>_key = <span class="hljs-string">"SSSSSSSSSSSSSSSS-ssssssssss"</span>

        <span class="hljs-preprocessor"># Uncomment ONE of the following service offerings:</span>
        cloudstack<span class="hljs-preprocessor">.service</span>_offering_id = <span class="hljs-string">"71004023-bb72-4a97-b1e9-bc66dfce9470"</span> <span class="hljs-preprocessor"># Micro - 512 MB</span>
        <span class="hljs-preprocessor">#cloudstack.service_offering_id = "b6cd1ff5-3a2f-4e9d-a4d1-8988c1191fe8" # Tiny - 1GB</span>
        <span class="hljs-preprocessor">#cloudstack.service_offering_id = "21624abb-764e-4def-81d7-9fc54b5957fb" # Small - 2GB</span>
        <span class="hljs-preprocessor">#cloudstack.service_offering_id = "b6e9d1e8-89fc-4db3-aaa4-9b4c5b1d0844" # Medium - 4GB</span>
        <span class="hljs-preprocessor">#cloudstack.service_offering_id = "c6f99499-7f59-4138-9427-a09db13af2bc" # Large - 8GB</span>
        <span class="hljs-preprocessor">#cloudstack.service_offering_id = "350dc5ea-fe6d-42ba-b6c0-efb8b75617ad" # Extra-large - 16GB</span>
        <span class="hljs-preprocessor">#cloudstack.service_offering_id = "a216b0d1-370f-4e21-a0eb-3dfc6302b564" # Huge - 32GB</span>

        cloudstack<span class="hljs-preprocessor">.keypair</span> = <span class="hljs-string">"vagrant"</span> <span class="hljs-preprocessor"># for SSH boxes the name of the public key pushed to the machine</span>
    end
end
</code></pre><p>Make sure to set your API keys and your keypair properly. Also edit the <code>config.vm.box</code> line to set the name of the box you actually added with <code>vagrant box add</code> and edit the <code>config.ssh.private_key_path</code> to point to the private key you got from exoscale. In this configuration the default security group will be used.</p>
<p>You are now ready to bring the box up:</p>
<pre><code><span class="hljs-attribute">vagrant up --provider</span>=<span class="hljs-string">cloudstack</span>
</code></pre><p>Don&#39;t forget to use the <code>--provider=cloudstack</code> or the box won&#39;t come up. Check the exoscale dashboard to see the machine boot, try to ssh into the box.</p>
<h2 id="add-provisioning-steps">Add provisioning steps</h2>
<p>Once you have successfully started a machine with vagrant, you are ready to specify a provisioning script. Create a <code>boostrap.sh</code> bash script in your working directory and make it do whatever your want.</p>
<p>Add this provisioning step in the <code>Vagrantfile</code> like so:</p>
<pre><code><span class="hljs-comment"># Test bootstrap script</span>
config.vm.provision <span class="hljs-symbol">:shell</span>, <span class="hljs-symbol">:path</span> =&gt; <span class="hljs-string">"bootstrap.sh"</span>
</code></pre><p>Relaunch the machine with <code>vagrant up</code> or <code>vagrant reload --provision</code>. To stop a machine <code>vagrant destroy</code></p>
<p>You are now ready to dig deeper into Vagrant provisioning. See the provisioner <a href="http://docs.vagrantup.com/v2/provisioning/index.html" target="_blank">documentation</a> and pick your favorite configuration management tool. For example with <a href="http://www.getchef.com" target="_blank">chef</a> you would specify a cookbook like so:</p>
<pre><code>config.vm.provision <span class="hljs-string">"chef_solo"</span> <span class="hljs-built_in">do</span> |chef|
    chef.add_recipe <span class="hljs-string">"mycookbook"</span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>
</code></pre><h2 id="puppet-example">Puppet example</h2>
<p>For <a href="http://docs.vagrantup.com/v2/provisioning/puppet_apply.html" target="_blank">Puppet</a> remember the script that we put in the Userdata of the very first example. We are going to use the same Puppet configuration but via Vagrant.</p>
<p>Edit the <code>Vagrantfile</code> to have:</p>
<pre><code>config.vm.provision <span class="hljs-string">"puppet"</span> <span class="hljs-built_in">do</span> |puppet|
    puppet.module_path = <span class="hljs-string">"modules"</span>
<span class="hljs-function"><span class="hljs-keyword">end</span></span>
</code></pre><p>Vagrant will look for the manifest in the <code>manifests</code> directory and for the modules in the <code>modules</code> directory.
Now simply clone the repository that we used earlier:</p>
<pre><code>git <span class="hljs-keyword">clone</span> https:<span class="hljs-comment">//github.com/retrack/exoscale-wordpress</span>
</code></pre><p>You should now see the <code>modules</code> and <code>manifests</code> directory in the root of your working directory that contains the <code>Vagrantfile</code>.
Remove the shell provisioning step, make sure to use the Ubuntu 12.04 template id and start the instance like before:</p>
<pre><code><span class="hljs-attribute">vagrant up --provider</span>=<span class="hljs-string">cloudstack</span>
</code></pre><p>Open your browser and get back to Wordpress ! Of course the whole idea of Vagrant is that you can test all of these provisioning steps on your local machines using VirtualBox. Once you are happy with your recipes you can then move to provision in the cloud. Check out <a href="http://packer.io" target="_blank">Packer</a> a related project which you can use to generate images for your cloud.</p>
<h2 id="playing-with-multi-machines-configuration">Playing with multi-machines configuration</h2>
<p>Vagrant is also very interesting because you can start multiple machines at <a href="http://docs.vagrantup.com/v2/multi-machine/index.html" target="_blank">once</a>. Edit the <code>Vagrantfile</code> to add a <code>web</code> and a <code>db</code> machine. Add the cloudstack specific information and specify different bootstrap scripts.</p>
<pre><code>config<span class="hljs-preprocessor">.vm</span><span class="hljs-preprocessor">.define</span> <span class="hljs-string">"web"</span> do |web|
  web<span class="hljs-preprocessor">.vm</span><span class="hljs-preprocessor">.box</span> = <span class="hljs-string">"tutorial"</span>
end

config<span class="hljs-preprocessor">.vm</span><span class="hljs-preprocessor">.define</span> <span class="hljs-string">"db"</span> do |db|
  db<span class="hljs-preprocessor">.vm</span><span class="hljs-preprocessor">.box</span> = <span class="hljs-string">"tutorial"</span>
end
</code></pre><p>You can control each machine separately <code>vagrant up web</code>, <code>vagrant up db</code> or all at once in parallel <code>vagrant up</code></p>
<p>Let the fun begin. Pick your favorite configuration management tool, decide what you want to provision, setup your recipes and launch the instances.</p>

                
                </section>
            
            </div>

            <div class="page-footer">
                
                    
                        
                        <a href="./ansible.html" class="navigation-link next">Next</a>
                        
                    
                
            </div>
        </div>
    </div>
</div>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="gitbook/app.js"></script>
    </body>
</html>